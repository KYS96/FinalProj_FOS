<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê¸€ì“°ê¸°</title>
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1407.0.min.js"></script>
</head>

<body>
  <!-- header thymeleaf ì‚½ì…-->
  <header th:replace="~{views/community/header :: header}"></header>
  <!-- banner ì‚½ì… -->
  <div th:replace="~{views/community/banner :: banner}"></div>

  <!-- ====== ê¸€ ì‘ì„± Start ====== -->
  <section class="container ud-features">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <h1 class="ud-widget-title mb-5">ê¸€ì“°ê¸°</h1>
        </div>
      </div>
    </div>
    <ul class="ms-4 mb-3" style="list-style-type: circle">
      <li>ìŒë€ë¬¼, ì°¨ë³„, ë¹„í•˜, í˜ì˜¤ ë° ì´ˆìƒê¶Œ, ì €ì‘ê¶Œ ì¹¨í•´ ê²Œì‹œë¬¼ì€ ë¯¼, í˜•ì‚¬ìƒì˜ ì±…ì„ì„ ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
    <form method="post">
      <div style="display: flex;">
        <select id="category" class="form-select form-select-lg mb-3" aria-label=".form-select-lg example"
          style="width: fit-content; font-size: 1rem;">
          <option selected>ê²Œì‹œíŒ ì„ íƒ(í•„ìˆ˜)</option>
          <option value="tips_and_info">ê¿€íŒ, ì •ë³´</option>
          <option value="free_and_humor">ììœ , ìœ ë¨¸</option>
        </select>
        <div class="input-group flex-nowrap mb-3 flex-grow-1" style="margin-left: 10px;">
          <span class="input-group-text" id="addon-wrapping">ì œëª©</span>
          <input type="text" class="form-control" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”." aria-label="Username"
            aria-describedby="addon-wrapping" id="title">
        </div>
      </div>

      <!--summernote-->
      <div id="summernote" name="editordata"></div>

      <!--ëª©ë¡ë³´ê¸° ë° ì œì¶œ-->
      <div class="container mt-4 mb-2">
        <div class="row-cols-sm-12">
          <button type="button" class="btn btn-dark" style="background-color: gray; border: none;"
            onclick="resetPost('ë„¤')">ì·¨ì†Œ</button>
          <button type="button" class="btn btn-primary" style="background-color: #5c8984; border: none"
            onclick="submitPost()">ë“±ë¡</button>
          <button type="button" class="btn btn-secondary"
            th:onclick="saveTempPost([[${session.loginUser?.memberId}]])">ì„ì‹œ ì €ì¥</button>
          <button type="button" class="btn btn-secondary"
            th:onclick="loadTempPost([[${session.loginUser?.memberId}]])">ì„ì‹œ ì €ì¥ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button type="button" class="btn btn-secondary" th:onclick="deleteAllIndexedDB()">ì¸ë±ìŠ¤ db ì „ì²´ ì²­ì†Œ</button>
        </div>
      </div>
    </form>
  </section>

  <div th:replace="~{views/community/footer :: footer}"></div>

  <!-- summernote script-->
  <script th:inline="javascript">
    $('#summernote').summernote({
      toolbar: [
        ['fontname', ['fontname']],
        ['fontsize', ['fontsize']],
        ['style', ['bold', 'italic', 'underline', 'strikethrough', 'clear']],
        ['color', ['forecolor', 'color']],
        ['table', ['table']],
        ['para', ['ul', 'ol', 'paragraph']],
        ['height', ['height']],
        ['insert', ['picture', 'link']],
        ['view', ['help']]
      ],
      fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', 'ë§‘ì€ ê³ ë”•', 'ê¶ì„œ', 'êµ´ë¦¼ì²´', 'êµ´ë¦¼', 'ë‹ì›€ì²´', 'ë°”íƒ•ì²´'],
      fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '22', '24', '28', '30', '36', '50', '72'],
      placeholder: 'ê²Œì‹œê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.',
      tabsize: 4,
      height: 600,
      focus: true,
      lang: 'ko-KR',
      callbacks: {
        //ë¡œì»¬ì— ì €ì¥í•˜ê³ , ì œì¶œí•  ë•Œ ì•„ë§ˆì¡´ì— ì—…ë¡œë“œí•˜ëŠ” ë°©ì‹ : 
        onImageUpload: function (files) {
          //1. ì´ë¯¸ì§€ë¥¼ ì˜¬ë¦´ ë•Œ ë§ˆë‹¤, indexDBì— ì €ì¥í•˜ëŠ” ë°©ì‹
          // for (var i = 0; i < files.length; i++) {
          //   var file = files[i];
          //   var reader = new FileReader();                                  //FileReader ê°ì²´ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ íŒŒì¼ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì½ì„ ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” JavaScript APIì…ë‹ˆë‹¤

          //   reader.onload = function (e) {                                  //onload : íŒŒì¼ ì½ê¸°ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆì„ ë•Œ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸
          //     var imageArrayBuffer = e.target.result;                       //e.target.result : íŒŒì¼ì˜ ë‚´ìš©ì„ ArrayBuffer í˜•íƒœë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
          //     var key = file.name + "-" + Date.now().toString();            //íŒŒì¼ ì´ë¦„ + í˜„ì¬ ì‹œê°„ì„ ë°”íƒ•ìœ¼ë¡œ keyë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
          //     var openRequestImageDB = indexedDB.open(imageDatabaseName, 1);         //indexedDB.open() : ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì—´ê±°ë‚˜ ìƒˆë¡œ ë§Œë“­ë‹ˆë‹¤.

          //     openRequestImageDB.onupgradeneeded = function (event) {              //indexedDB ë°ì´í„°ë² ì´ìŠ¤ê°€ ì—…ê·¸ë ˆì´ë“œë˜ì–´ì•¼ í•  ê²½ìš°, onupgradeneeded ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.
          //       var db = event.target.result;
          //       if (!db.objectStoreNames.contains(imageStoreName)) {
          //         db.createObjectStore(imageStoreName);                           //imagesë¼ëŠ” ì´ë¦„ì˜ ê°ì²´ ìŠ¤í† ì–´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
          //       }
          //     };

          //     openRequestImageDB.onsuccess = function (event) {                    //indexedDB ë°ì´í„°ë² ì´ìŠ¤ê°€ ì—´ë¦° í›„, onsuccess ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.
          //       var db = event.target.result;
          //       var transaction = db.transaction([imageStoreName], 'readwrite');  //íŠ¸ëœì­ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤. íŠ¸ëœì­ì…˜ì€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ ì½ê±°ë‚˜ ì“¸ ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
          //       var store = transaction.objectStore(imageStoreName);              //íŠ¸ëœì­ì…˜ì„ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•  ê°ì²´ ìŠ¤í† ì–´ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
          //       var putRequest = store.put(imageArrayBuffer, key);          //imageArrayBufferë¥¼ images ê°ì²´ ìŠ¤í† ì–´ì— put ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤.

          //       putRequest.onsuccess = function (event) {                   //put ë©”ì„œë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©´, get ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ image í‚¤ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ ì½ì–´ì˜µë‹ˆë‹¤.
          //         var getRequest = store.get(key);                          //ì´ë¯¸ì§€ë¥¼ ì½ì–´ì˜¤ê¸° ìœ„í•´ get ë©”ì„œë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë§¤ê°œë³€ìˆ˜ë¡œëŠ” ì´ë¯¸ì§€ì˜ í‚¤ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.
          //         console.log("ì´ë¯¸ì§€ ì €ì¥ ì„±ê³µ, keyëŠ” " + key + "ì…ë‹ˆë‹¤.");

          //         getRequest.onsuccess = function (event) {
          //           var imageArrayBuffer = event.target.result;           //storeì— arrayBufferë¡œ ì €ì¥ëœ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
          //           console.log("ğŸš€ ~ file: comm_write.html:127 ~ imageArrayBuffer:", imageArrayBuffer);
          //           var blob = new Blob([imageArrayBuffer]);                //Blob ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. Blob ê°ì²´ëŠ” ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´ë¡œ, ì´ì§„ ë°ì´í„°ë¥¼ ë‹¤ë£° ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
          //           console.log("ğŸš€ ~ file: comm_write.html:129 ~ blob:", blob);
          //           var url = URL.createObjectURL(blob);
          //           console.log("ğŸš€ ~ file: comm_write.html:131 ~ url:", url);
          //           /*imageArrayBufferë¥¼ Blob ê°ì²´ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. Blob ê°ì²´ëŠ” ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´ë¡œ, ì´ì§„ ë°ì´í„°ë¥¼ ë‹¤ë£° ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤
          //           URL.createObjectURL(blob) ë©”ì„œë“œëŠ” Blob ê°ì²´ë¥¼ URL í˜•íƒœë¡œ ë³€í™˜í•©ë‹ˆë‹¤. 
          //           ì´ URLì€ img ìš”ì†Œì˜ src ì†ì„±ì— í• ë‹¹ë©ë‹ˆë‹¤. ë”°ë¼ì„œ Blob ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê³¼ì •ì€ ì´ë¯¸ì§€ë¥¼ img ìš”ì†Œì˜ src ì†ì„±ì— í• ë‹¹í•˜ê¸° ìœ„í•œ ì¤‘ê°„ ê³¼ì •ì…ë‹ˆë‹¤.

          //           ì—¬ê¸°ì„œ ì•„ë§ˆì¡´awsì˜ì£¼ì†Œë¡œ í• ë‹¹í•˜ë©´ ì•ˆë˜ê² ëƒê³  ë¬¼ìœ¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë‹µí•˜ê² ìŠµë‹ˆë‹¤.
          //           ë§Œë“¤ì–´ ë†“ì€ blob ì£¼ì†ŒëŠ” indexedDBì˜ ì£¼ì†Œì…ë‹ˆë‹¤.?? ë§ë‚˜ìš”????
          //           */

          //           //ë‹¤ ëë‚¬ìœ¼ë‹ˆ íƒœê·¸ë¥¼ ë§Œë“¤ì–´ì„œ summernoteì— ë„£ì–´ì¤ë‹ˆë‹¤.
          //           var imgNode = document.createElement('img');            //imgNodeë¼ëŠ” ì´ë¦„ì˜ img ìš”ì†Œë¥¼ ìƒì„±í•˜ê³ , src ì†ì„±ì— blob URLì„ í• ë‹¹í•©ë‹ˆë‹¤.
          //           imgNode.src = url;
          //           $('#summernote').summernote('insertNode', imgNode);     //imgNodeë¥¼ summernote ì—ë””í„°ì— ì‚½ì…í•©ë‹ˆë‹¤
          //         };
          //       };
          //     };
          //   };
          //   reader.readAsArrayBuffer(files[0]);                              //FileReader ê°ì²´ì˜ readAsArrayBuffer ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ì´ë¯¸ì§€ íŒŒì¼ì„ ì½ì–´ë“¤ì…ë‹ˆë‹¤.
          // }

          // ê·¸ëƒ¥ ë°”ë¡œ ì•„ë§ˆì¡´ì— ì˜¬ë¦½ë‹ˆë‹¤
          var file = files[0];
          var fileName = file.name;
          console.log("ğŸš€ ~ file: comm_write.html:156 ~ fileName:", fileName)
          var reader = new FileReader();
          reader.onload = function () {
            var fileContent = new Uint8Array(reader.result);
            var params = {
              Bucket: bucketName,
              Key: fileName,
              Body: fileContent,
              ContentType: file.type
            };
            s3.upload(params, function (err, data) {
              if (err) {
                console.log(err);
              } else {
                console.log('File uploaded successfully. File location:', data.Location);
                var imgNode = document.createElement('img');
                imgNode.src = data.Location;
                $('#summernote').summernote('insertNode', imgNode);
              }
            });
          };
          reader.readAsArrayBuffer(file);

        }
      }
    });

    //AWS
    // Initialize the Amazon Cognito credentials provider
    AWS.config.region = 'ap-northeast-2'; // Region
    AWS.config.credentials = new AWS.CognitoIdentityCredentials({
      IdentityPoolId: 'ap-northeast-2:d70b0ade-b06e-49bc-b9cd-9f0eb59df8c7',
    });

    var bucketName = 'finalsof';

    var s3 = new AWS.S3({
      apiVersion: "2006-03-01",
      params: { Bucket: bucketName }
    });

    //ìœ„ì˜ ê³¼ì •ì€ ì•„ë˜ ê³¼ì •ê³¼ ë™ì¼í•œ ê²ƒì´ë‹¤. ì•„ë˜ëŠ” ë‹¤ë§Œ ì˜ˆì „ ë²„ì „ì¸ ë“¯ í•˜ë‹¤. ì•„ë‹ˆë©´ ë‹¤ë¥¸ ë°©ì‹ì´ë˜ê°€.
    // var albumBucketName = "finalsof";
    // var bucketRegion = "ap-northeast-2";
    // var IdentityPoolId = "IDENTITY_POOL_ID";

    // AWS.config.update({
    //   region: bucketRegion,
    //   credentials: new AWS.CognitoIdentityCredentials({
    //     IdentityPoolId: IdentityPoolId
    //   })
    // });

    //1. PostDatabase ìƒì„±í•˜ê¸° : ìœ ì €ë³„ ê³ ìœ  ìŠ¤í† ë¦¬ì§€ ìœ„í•´ ìœ ì €ì˜ ì•„ì´ë”” DBëª…ì— ì‚¬ìš©.
    /* ê²Œì‹œê¸€ì„ ì„ì‹œ ì €ì¥í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ ë†“ì€ IndexedDBì…ë‹ˆë‹¤. ì´ DBëŠ” ì „ì²´ ê²Œì‹œê¸€ ì €ì¥ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
    ìœ„ì˜ summernoteì˜ onImageUploadëŠ” ê·¸ì™€ëŠ” ë‹¬ë¦¬ ì˜¤ì§ ì´ë¯¸ì§€ ì €ì¥ë§Œì„ ìœ„í•´ ì¡´ì¬í•©ë‹ˆë‹¤.*/
    var db;                                                                   //dbë³€ìˆ˜ ì„ ì–¸
    var memberId = /*[[${session.loginUser?.memberId}]]*/0;                    //ìœ ì €ì˜ ì•„ì´ë””
    var memberNo = /*[[${session.loginUser?.memberNo}]]*/0;                    //ìœ ì €ì˜ ë²ˆí˜¸

    var imageDatabaseName = "ImageDatabase";                                  //ì´ë¯¸ì§€ dbì´ë¦„
    var postDatabaseName = "PostDatabase";                                    //ê²Œì‹œê¸€ dbì´ë¦„
    var imageStoreName = "image store for " + memberId;                       //ì´ë¯¸ì§€ DB ë‚´ í…Œì´ë¸”(ìŠ¤í† ì–´) ì´ë¦„
    var postStoreName = "post store for " + memberId;                         //ê²Œì‹œê¸€ DB ë‚´ í…Œì´ë¸”(ìŠ¤í† ì–´) ì´ë¦„

    var request = window.indexedDB.open(postDatabaseName, 1);

    request.onerror = function (event) {
      console.log("Post indexedDB database load error: " + event.target.errorCode);
    };

    request.onsuccess = function (event) {
      db = request.result;                                                    //ì„±ê³µí•œë‹¤ë©´, dbë³€ìˆ˜ì— dbì €ì¥
      console.log("Post indexedDB database load success");
    };

    //2. indexedDB ê°ì²´ ìŠ¤í† ì–´ ìƒì„± : DBì˜ ë‚´ë¶€ì— ê°ì²´ ìŠ¤í† ì–´(í…Œì´ë¸”)ì„ ìƒì„±í•´ì•¼í•¨.
    request.onupgradeneeded = function (event) {
      db = event.target.result;                                               //indexedDBì—ì„œ ì‚¬ìš©ë˜ëŠ” ì´ë²¤íŠ¸ ê°ì²´ì˜ ì†ì„± ì¤‘ í•˜ë‚˜, indexedDb íŠ¸ëœì ì…˜ì—ì„œ ì‹¤í–‰ëœ ìš”ì²­ì˜ ê²°ê³¼ë¥¼ ë°˜í™˜
      var objectStore = db.createObjectStore(postStoreName, { keyPath: 'id' });
      console.log('Post store created successfully');
    };

    //3. indexedDBì— ì„ì‹œì €ì¥í•˜ê¸° : db.transaction()ë©”ì„œë“œë¡œ íŠ¸ëœì­ì…˜ ìƒì„±, objectStore.add()(or put)ë©”ì„œë“œë¡œ ë°ì´í„° ì¶”ê°€
    /* ì°¸ê³ !! : objectStore.add()ì™€ objectStore.put()ì´ ìˆëŠ”ë°,ë‘ ë©”ì„œë“œëŠ” ë°ì´í„°ê°€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš° ë‹¤ë¥´ê²Œ ë™ì‘í•©ë‹ˆë‹¤.
    
    objectStore.add()ëŠ” ê°ì²´ ìŠ¤í† ì–´ì— ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ê¸° ì „ì—, í•´ë‹¹ í‚¤ê°€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. 
    ë§Œì•½ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´, ì¶”ê°€í•˜ì§€ ì•Šê³  error ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤. 
    ë”°ë¼ì„œ add() ë©”ì„œë“œëŠ” ì¤‘ë³µëœ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ì§€ ì•Šë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤

    ë°˜ë©´ì—, objectStore.put()ì€ ê°ì²´ ìŠ¤í† ì–´ì— ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ê¸° ì „ì—, í•´ë‹¹ í‚¤ê°€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. 
    ë§Œì•½ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´, ê¸°ì¡´ ë°ì´í„°ë¥¼ ë®ì–´ì”Œì›ë‹ˆë‹¤. 
    ë”°ë¼ì„œ put() ë©”ì„œë“œëŠ” ì¤‘ë³µëœ ë°ì´í„°ë¥¼ ë®ì–´ì”Œìš°ëŠ” ê²ƒì„ í—ˆìš©í•©ë‹ˆë‹¤.

    ë”°ë¼ì„œ, add() ë©”ì„œë“œëŠ” ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì¶”ê°€í•  ë•Œ ì‚¬ìš©í•˜ê³ , 
    put() ë©”ì„œë“œëŠ” ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

        //ìš”ì•½!!
    putì€ ê·¸ í‚¤ë¥¼ ê°€ì§„ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ìƒˆë¡œ ë§Œë“¤ê³ , ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸ í•©ë‹ˆë‹¤.
    í˜„ì¬ ëª©ì ì—ëŠ” ê³„ì† ì„ì‹œì €ì¥í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” keyë¥¼ ìœ ì €ì˜ idë¥¼ í™œìš©í•´ì„œ ìƒìˆ˜ë¡œ ë§Œë“¤ ê²ƒì´ë¯€ë¡œ
    putì´ ì í•©í•´ ë³´ì…ë‹ˆë‹¤.
    */
    function saveTempPost(id) {
      //putì˜ íŠ¹ì„± ìƒ ì´ ì €ì¥ì€ ê³„ì† ê°±ì‹ í•˜ëŠ” ì €ì¥ì…ë‹ˆë‹¤. (ì´ì „ ë²„ì „ ë³¼ ìˆ˜ ì—†ìŒ.)
      var content = $('#summernote').summernote('code');
      var transaction = db.transaction([postStoreName], 'readwrite');  //ìŠ¤í† ì–´ postStoreName íŠ¸ëœì ì…˜ ìˆ˜í–‰í•˜ê³ , ëª¨ë“œëŠ” readWrite(ì½ê¸°ì“°ê¸°). íŠ¸ëœì ì…˜ ì¢…ë£Œì‹œ ìë™ìœ¼ë¡œ ì»¤ë°‹ë¨.
      var objectStore = transaction.objectStore(postStoreName);
      var request = objectStore.put({ id: id, content: content });     //ë³€ìˆ˜ë¡œ ë°›ì€ idì™€ í˜„ì¬ ì„œë¨¸ë…¸íŠ¸ì˜ contentë¡œ ìŠ¤í† ì–´ì— ì €ì¥í•¨(key - valueë¡œ) putì„ ì‚¬ìš©í•´ ì¤‘ë³µ ì‹œ ë®ì–´ì”Œì›€.

      //ì½˜ì†”
      console.log("id : " + id);
      console.log("content : " + content);
      console.log("transaction : " + transaction);
      console.log("objectStore : " + objectStore);
      console.log("request : " + request);

      request.onerror = function (event) {
        console.log('Error adding post to object store');
      };
      request.onsuccess = function (event) {
        console.log('Post added to object store');
      };
    }

    //4. indexedDBì— ì„ì‹œì €ì¥ëœ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° : objectStore.getìœ¼ë¡œ ê°€ì ¸ì˜´.
    function loadTempPost(id) {
      var transaction = db.transaction([postStoreName], 'readonly');
      var objectStore = transaction.objectStore(postStoreName);
      var request = objectStore.get(id);

      request.onerror = function (event) {
        console.log('Error getting post from object store');
      };

      request.onsuccess = function (event) {
        var post = request.result;
        console.log('Post retrieved from object store');
        if (post) {
          $('#summernote').summernote('code', post.content);                    //postê°€ ì¡´ì¬í•œë‹¤ë©´, ì—ë””í„°ì— post.contentë¥¼ ë„£ì–´ì¤Œ.
        }
      };
    }

    //ëª¨ë“  indexedDBë‚ ë¦¬ê¸°(ì‹¤í—˜ìš©ìœ¼ë¡œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤)
    function deleteAllIndexedDB() {
      indexedDB.databases().then(function (databases) {
        for (var i = 0; i < databases.length; i++) {
          var database = databases[i];
          var deleteRequest = indexedDB.deleteDatabase(database.name);

          deleteRequest.onsuccess = function (event) {
            console.log(database.name + ' has been deleted from indexedDB.');
          };
        }
      });
    }

    //ì„œë¨¸ë…¸íŠ¸ ì´ˆê¸°í™” í•¨ìˆ˜. 
    function resetPost(answer) {
      if (answer == "ë„¤") {
        $('#summernote').summernote('reset');
      } else {
        return;
      }
    }

    

    //ì œì¶œí•˜ê¸°
    function submitPost() {
      var content = $('#summernote').summernote('code');                                          //ì„œë¨¸ë…¸íŠ¸ì˜ ë‚´ìš© ì €ì¥

      if (content.trim() === '') {                                                                //ë‚´ìš©ì´ ì—†ìœ¼ë©´ ê²½ê³ ì°½ ë„ìš°ê³  í•¨ìˆ˜ ì¢…ë£Œ
        alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      //contentë¥¼ ì„œë²„ë¡œ ë³´ëƒ„. endpointëŠ” /commPostSubmit
      $.ajax({
        type: 'POST',
        url: '/commPostSubmit',
        data: {
          content: content,
          title: $('#title').val(),
          category: $('#category option:selected').val(),
          memberNo: memberNo
        },
        success: function (response) {
          if (response['result'] == 'success') {
            alert('ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.history.back();
          } else {
            alert('ê²Œì‹œê¸€ ë“±ë¡ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.');
          }
        }
      });




      //ì•„ë˜ëŠ” ì˜›ë‚  ì½”ë“œë¼ì„œ ì“¸ëª¨ì—†ìŒ.
      // var openRequest = indexedDB.open(postDatabaseName, 1);                                      //indexedDBì— ì „ì—­ë³€ìˆ˜ì¸ dbIdë¡œ ì´ë¦„ì§€ì€ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì—´ê³ 

      // openRequest.onupgradeneeded = function (event) {                                            //ë°ì´í„°ë² ì´ìŠ¤ê°€ ì—…ê·¸ë ˆì´ë“œ ë˜ë©´
      //   var db = event.target.result;                                                             //dbì— ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì €ì¥
      //   var objectStore = db.createObjectStore(postStoreName, { keyPath: 'id'});                  //objectStoreì— ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•  ê°ì²´ë¥¼ ì €ì¥
      //   objectStore.createIndex('content', 'content', { unique: false });                         //objectStoreì— contentë¼ëŠ” ì¸ë±ìŠ¤ë¥¼ ë§Œë“¤ê³ 
      //   objectStore.createIndex('image', 'image', { unique: false });                             //objectStoreì— imageë¼ëŠ” ì¸ë±ìŠ¤ë¥¼ ë§Œë“ ë‹¤.
      // };

      // openRequest.onsuccess = function (event) {                                                  //ë°ì´í„°ë² ì´ìŠ¤ê°€ ì—´ë¦¬ë©´ 
      //   var db = event.target.result;                                                             //dbì— ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì €ì¥
      //   var transaction = db.transaction([tempId], 'readwrite');                                  //transactionì— ë°ì´í„°ë² ì´ìŠ¤ì˜ tempIdë¼ëŠ” ì´ë¦„ì˜ objectStoreë¥¼ ì €ì¥
      //   var store = transaction.objectStore(tempId);                                              //storeì— transactionì— ì €ì¥ëœ objectStoreë¥¼ ì €ì¥

      //   var post = { content: content, image: null };                                             //postì— contentì™€ imageë¥¼ ì €ì¥
      //   var files = $('#summernote').summernote('getImages');                                     //filesì— ì´ë¯¸ì§€ íŒŒì¼ë“¤ì„ ì €ì¥
      //   console.log("ğŸš€ ~ file: s3_photoExample.js:52 ~ submitPost ~ files:", files)

      //   if (files.length > 0) {                                                                   //ë§Œì•½ íŒŒì¼ì´ ìˆë‹¤ë©´
      //     var uploadedCount = 0;                                                                  //ì—…ë¡œë“œëœ íŒŒì¼ì˜ ìˆ˜ë¥¼ ì €ì¥í•˜ëŠ” ë³€ìˆ˜
      //     var totalFiles = files.length;                                                          //ì „ì²´ íŒŒì¼ì˜ ìˆ˜ë¥¼ ì €ì¥í•˜ëŠ” ë³€ìˆ˜

      //     // Loop through all the selected files
      //     for (var i = 0; i < files.length; i++) {
      //       var file = files[i];
      //       var formData = new FormData();
      //       formData.append('file', file);

      //       $.ajax({                                                                              //ajaxë¥¼ ì´ìš©í•´
      //         url: 'https://finalsof.s3.ap-northeast-2.amazonaws.com/',
      //         type: 'POST',
      //         data: formData,
      //         processData: false,
      //         contentType: false,
      //         success: function (data) {
      //           var imageUrl = 'https://finalsof.s3.ap-northeast-2.amazonaws.com/' + file.name;   // ì„±ê³µí•˜ë©´ imageUrlì— awsì£¼ì†Œë¥¼ ì €ì¥
      //           post.image = post.image ? post.image + ',' + imageUrl : imageUrl;                 // Append the uploaded image URL to the post object

      //           uploadedCount++;                                                                  // Increment the uploaded count

      //           if (uploadedCount === totalFiles) {                                               // Check if all files have been uploaded
      //             var addRequest = store.add(post);

      //             addRequest.onsuccess = function (event) {
      //               console.log('Post has been added to indexedDB.');
      //               var html = content.replace(/<img[^>]*src="[^"]*"/gi, function (match) {
      //                 var src = match.match(/src="([^"]*)"/i)[1];
      //                 return 'src="' + imageUrl + '"';
      //               });
      //               console.log("html : " + html);
      //               // Send the HTML data to the server using AJAX or fetch API
      //               $.ajax({
      //                 url: '/post',
      //                 type: 'POST',
      //                 data: { html: html },
      //                 success: function (data) {
      //                   console.log('HTML data has been sent to the server.');
      //                   resetPost('ë„¤');
      //                 },
      //                 error: function (xhr, status, error) {
      //                   console.log('Error sending HTML data to the server: ' + error);
      //                 }
      //               });                                                            //ì„œë¨¸ë…¸íŠ¸ ì´ˆê¸°í™”
      //             };
      //           }
      //         },
      //         error: function (xhr, status, error) {
      //           console.log('Error uploading image to S3: ' + error);
      //         }
      //       });
      //     }
      //   } else {
      //     var addRequest = store.add(post);

      //     addRequest.onsuccess = function (event) {
      //       console.log('Post has been added to indexedDB.');

      //       // Send the HTML data to the server using AJAX or fetch API
      //       $.ajax({
      //         url: '/post',
      //         type: 'POST',
      //         data: { html: content },
      //         success: function (data) {
      //           console.log('HTML data has been sent to the server.');
      //           resetPost('ë„¤');
      //         },
      //         error: function (xhr, status, error) {
      //           console.log('Error sending HTML data to the server: ' + error);
      //         }
      //       });
      //     };
      //   }
      // };

      // openRequest.onerror = function (event) {
      //   alert('indexedDB database error: ' + event.target.errorCode);
      // };
    }
  </script>
</body>

</html>